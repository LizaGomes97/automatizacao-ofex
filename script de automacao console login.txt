// Script de Login Terminal Drogasil - Versão Final
(async function() {
    console.clear();
    console.log("%cScript de Login Terminal Drogasil - Versão Final", "color: #C41E3A; font-size: 16px; font-weight: bold");
    
    // Configurações
    const matricula = "309515"; // Sua matrícula
    
    try {
        // Etapa 1: Focar no campo correto
        console.log("Localizando campo de entrada...");
        
        // Campo identificado na última tentativa
        const campoMatricula = document.getElementById('txtCpfAtendimento');
        
        if (!campoMatricula) {
            console.error("Campo de matrícula não encontrado!");
            return;
        }
        
        console.log(`Campo localizado: ${campoMatricula.id}`);
        
        // Etapa 2: Focar o campo e limpar qualquer valor existente
        campoMatricula.focus();
        campoMatricula.value = '';
        await new Promise(r => setTimeout(r, 300));
        
        // Etapa 3: Digitar a matrícula caractere por caractere (mais confiável)
        console.log(`Digitando matrícula: ${matricula}`);
        
        for (let i = 0; i < matricula.length; i++) {
            campoMatricula.value += matricula[i];
            // Disparar evento de input após cada caractere
            campoMatricula.dispatchEvent(new Event('input', { bubbles: true }));
            await new Promise(r => setTimeout(r, 100));
        }
        
        // Etapa 4: Disparar eventos adicionais que podem ser necessários
        campoMatricula.dispatchEvent(new Event('change', { bubbles: true }));
        campoMatricula.dispatchEvent(new Event('blur', { bubbles: true }));
        
        await new Promise(r => setTimeout(r, 500));
        
        // Etapa 5: Encontrar o botão associado
        console.log("Procurando botão de submissão...");
        
        // Tenta encontrar o botão pelo ID relacionado
        const btnSubmit = document.getElementById('btnLogin') || 
                         document.getElementById('buttonLogin') ||
                         document.getElementById('buttonAtendente') ||
                         document.getElementById('btLogin') ||
                         document.querySelector('[id*="login" i]') ||
                         document.querySelector('[id*="atendente" i]');
        
        if (btnSubmit) {
            console.log(`Botão encontrado (ID: ${btnSubmit.id}). Clicando...`);
            btnSubmit.click();
            return;
        }
        
        // Busca por qualquer elemento clicável nas proximidades
        console.log("Buscando elemento clicável próximo ao campo...");
        
        const rect = campoMatricula.getBoundingClientRect();
        const elementos = document.elementsFromPoint(rect.right + 30, rect.top + rect.height/2);
        
        if (elementos && elementos.length > 0) {
            // Pegar o primeiro elemento clicável
            const clicavel = elementos.find(el => 
                el.tagName === 'BUTTON' || 
                el.tagName === 'A' || 
                el.tagName === 'INPUT' ||
                el.style.cursor === 'pointer' || 
                getComputedStyle(el).cursor === 'pointer'
            );
            
            if (clicavel) {
                console.log(`Elemento clicável encontrado: ${clicavel.tagName}. Clicando...`);
                clicavel.click();
                return;
            }
        }
        
        // Se nada funcionar, tenta simular o Enter no campo
        console.log("Última tentativa: simulando tecla Enter...");
        const enterEvent = new KeyboardEvent('keydown', {
            bubbles: true,
            cancelable: true,
            key: 'Enter',
            code: 'Enter',
            keyCode: 13,
            which: 13
        });
        
        campoMatricula.dispatchEvent(enterEvent);
        
        console.log("Processo concluído. Verifique se o login foi realizado.");
        
    } catch (erro) {
        console.error("Erro durante o processo:", erro);
    }
})();